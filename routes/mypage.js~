
/*
 * GET home page.
 */
exports.login = function(request, response) {

    var userName, password, status;
    if(! isEmpty(request.query)) { /* Get method */
	userName = request.query.username;
	password = request.query.password;
	status = authenticate(userName, password);
	if(status) {
	    console.log('authenticated');
	    response.render('tt', {title: 'Something happened to you!', header: 'my header'});
	    //response.send('Hello ' + userName);
	} else {
	    console.log('Intruder');
	    response.send('Oy Intruder!');
	}
    } else if(! isEmpty(request.body)) { /* Post method */
	console.log('body is not empty');
	userName = request.body.username;
	password = request.body.password;
	status = authenticate(userName, password);
	if(status) {
	    console.log('authenticated');
	    response.render('tt', {title: 'MyApp - Home', welcomemsg: 'Welcome ' + userName});
	} else {
	    console.log('Intruder');
	    response.send('Oy Intruder!');
	}
    } else { /* Either Get/Post but with no param/body */
	console.log('Request is empty');
    }
    response.end();
}

exports.index = function(req, res){
  res.render('index', { useless: 'i am useless', title: 'Express' });
};

var isEmpty = function(obj) {
    var empty = true;
    for(key in obj) {
	if(obj.hasOwnProperty(key)) {
	    return false;
	}
    }
    return true;
}

var authenticate = function(userName, password) {
    if(userName === 'test' && password == 'test') {
	return true;
    } else {
	return false;
    }
}
